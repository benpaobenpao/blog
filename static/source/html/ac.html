<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    -->
    <meta name="description" content="民生银行-我们在行动" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="pragram" content="no-cache" />
    <link rel="stylesheet" href="http://app.78.cn/weixin/ms/main.css">
    <link rel="stylesheet" href="http://app.78.cn/weixin/ms/wumai.css">
    <title>应对雾霾，我们在行动</title>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript">
(function () {
    if(/Android (\d+\.\d+)/.test(navigator.userAgent)){
        var version = parseFloat(RegExp.$1);
        if(version>2.3){
            var phoneScale = parseInt(window.screen.width)/640;
            document.write('<meta name="viewport" content="width=640, minimum-scale = '+ phoneScale +', maximum-scale = '+ phoneScale +', target-densitydpi=device-dpi">');
        }else{
            document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
        }
    }else{
        document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
    }
})();
</script>
</head>
<body>

    <div id="container">
        <!-- <img src="share.png" width="400" height="400" alt="" class="hideimg">
        -->
        <div class="sound" id="musicTip">
            <img src="http://app.78.cn/weixin/ms/images/lab.png" alt="">
            <img class="laSml sounD" src="http://app.78.cn/weixin/ms/images/laSml.png" alt="">
            <img class="laBig sounD" src="http://app.78.cn/weixin/ms/images/laBig.png" alt="">
            <img class="close sounD" src="http://app.78.cn/weixin/ms/images/close.png" alt="">
        </div>
        <div class="wrapper" id="wrapper">
            <div class="item active item0" id="item0">
                <img class="logo animated zoomInn" src="http://app.78.cn/weixin/ms/images/logo.png" alt="">
                <img class="sj animated flipIn first" src="http://app.78.cn/weixin/ms/images/sj.png" alt="">
                <img class="sj animated rotate flipInX first" src="http://app.78.cn/weixin/ms/images/sj.png" alt="">
                <p class="content animated zoomInn second ">
                    已有<br/>
                    <i class="num"><?php echo $totalUserNums;?></i><strong>名</strong><br/>
                    <i>民生人</i><br/>
                    在行动
                </p>
            </div>
            <div class="item item1">
                <img class="littleLogo animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/littleLogo.png" alt="">
                <img class="one-leaf animated fadeOutDown" src="http://app.78.cn/weixin/ms/images/one-leaf.png" alt="">
                <p>
                    雾霾，顾名思义是雾和霾。但是雾和霾的区别很大。 空气中的灰尘、硫酸、硝酸等颗粒物组成的气溶胶系统造 成视觉障碍的叫霾。霾就是灰霾（烟霞）。
                </p>
                <img class="kulou animated zoomIn" src="http://app.78.cn/weixin/ms/images/kulou.png" alt="">
                <img class="war animated bounce" src="http://app.78.cn/weixin/ms/images/war.png" alt="">
                <img class="two-content animated bounceInRight" src="http://app.78.cn/weixin/ms/images/two-content.png" alt=""></div>
            <div class="item item2">
                <img class="three-title animated zoomInn" src="http://app.78.cn/weixin/ms/images/three-title.png" alt="">
                <img class="three-1title animated bounceInRight" src="http://app.78.cn/weixin/ms/images/three-1title.png" alt="">
                <img class="three-1img animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/three-1img.png" alt="">
                <img class="three-2title animated bounceInRight" src="http://app.78.cn/weixin/ms/images/three-2title.png" alt="">
                <img class="three-2img animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/three-2img.png" alt=""></div>
            <div class="item item3">
                <img class="three-leaf animated fadeOutDown" src="http://app.78.cn/weixin/ms/images/three-leaf.png" alt="">
                <p>急剧的工业化和城市化导致能源迅猛消耗、人口高度 聚集、生态环境破坏，都为雾霾天气的形成埋下伏笔。</p>
                <img class="three-1 animated bounceInRight" src="http://app.78.cn/weixin/ms/images/three-1.png" alt="">
                <img class="three-2 animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/three-2.png" alt="">
                <img class="three-3 animated bounceInRight" src="http://app.78.cn/weixin/ms/images/three-3.png" alt=""></div>
            <div class="item item4">
                <img class="four-leaf animated fadeOutDown" src="http://app.78.cn/weixin/ms/images/four-leaf.png" alt="">
                <p>
                    一些科学家指出，雾霾的最大成因很可能是烧煤，而煤是中国这些年发展的支柱性能源。中国前些年显然低估了工业污染的严重性，但怨声载道没有用，光空喊要求“政府作为”，如果我们大家不真正行动起来，政府的“作为”就只能是空许诺。
                </p>
                <img class="bike animated bounceInRight" src="http://app.78.cn/weixin/ms/images/bike.png" alt="">
                <img class="Shape animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/Shape.png" alt="">
                <img class="vector animated bounceInRight" src="http://app.78.cn/weixin/ms/images/vector.png" alt=""></div>
            <div class="item item5">
                <img class="five-1 animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/five-1.png" alt="">
                <img class="five-2 animated bounceInRight" src="http://app.78.cn/weixin/ms/images/five-2.png" alt="">
                <img class="five-3 animated bounceInLeft" src="http://app.78.cn/weixin/ms/images/five-3.png" alt="">
                <img class="five-leaf animated fadeOutDown" src="http://app.78.cn/weixin/ms/images/five-leaf.png" alt=""></div>

            
            
            <div class="item item13" id="lastItem">
                <img src="http://app.78.cn/weixin/ms/images/order.jpg">
            </div>                  
        </div>  
    </div>
    
    </span>
    <span class="share-tip" id="shareTip">
        <div class="mask"></div> <i class="icon icon-share-tip"><img class="yun animated zoomInRight first" src="http://app.78.cn/weixin/ms/images/yun.png" alt=""></i>
    </span>
    <span class=" tip" id="tip"></span>
    <audio src="http://app.78.cn/weixin/ms/love.mp3" id="bgAudio" autoplay loop="loop"></audio>
<div class="loading" id="loading">
    <div class="spinner">
        <div class="spinner-container container1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div id="loadingNum">0%</div>
    </div>
</div>
<script type="text/javascript">
wx.config({
    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
    appId: '<?php echo $signPackage["appId"];?>',
    timestamp:<?php echo $signPackage["timestamp"];?>,
    nonceStr : '<?php echo $signPackage["nonceStr"];?>',
    signature : '<?php echo $signPackage["signature"];?>',
    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
}); 

// config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
wx.ready(function(){
    //var olink = location.host + "/" + location.pathname.match(/[a-zA-Z0-9]+\//g).join("");
    var oData = (function() {
        return {
            title: '应对雾霾，我们在行动', // 分享标题
            desc: '应对雾霾，我们在行动，民生银行客户服务部。', // 分享描述
            link: 'http://dev.bnfvn.com/index.php?r=test/index/ms', // 分享链接
            imgUrl: 'http://app.78.cn/weixin/ms/images/logoshare.png', // 分享图标
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function() {
                // 用户确认分享后执行的回调函数
            },
            cancel: function() {
                // 用户取消分享后执行的回调函数
            }
        }
    })();
    wx.onMenuShareTimeline(oData);//朋友圈绑定
    wx.onMenuShareAppMessage(oData);//消息绑定
    wx.onMenuShareQQ(oData);//QQ绑定
    wx.onMenuShareWeibo(oData);//微博绑定
});
wx.error(function(res){
    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。

});
</script>
<script type="text/javascript" src="http://app.78.cn/weixin/ms/touchScroll.js"></script>
<script type="text/javascript">
    //http://app.78.cn/weixin/ms/index.html
    function $(el){
        return typeof el == 'string' ? document.querySelector(el) : el;
    }
    function $$(el){
        return typeof el == 'string' ? document.querySelectorAll(el) : el;
    }
    var EL ={
        wrapper:$('#wrapper'),
        item:$$('.item'),
        loading:$('#loading'),
        audio:$('#bgAudio'),
        musicTip:$('#musicTip'),
        audio:$('#bgAudio'),
        shareTip:$('#shareTip'),
        lastItem:$('#lastItem'),
        tip:$('#tip')
    }
    var config = {
        closeBGM:false,
        loadImgIndex:0,
        path:'http://app.78.cn/weixin/ms/images/'
    }
    var touchScroll;
    var APP = {
        init:function(){
            this.loadImg(['Bg1.png','bike.png','close.png','content.png','five-1.png', 'five-2.png', 'five-3.png', 'five-leaf.png', 'fiveBg.png', 'four-leaf.png', 'fourBg.png', 'fz.png', 'kulou.png', 'lab.png', 'laBig.png', 'laSml.png', 'littleLogo.png', 'logo.png', 'one-leaf.png', 'oneBg.png', 'Shape.png', 'sj.png', 'three-1.png', 'three-2.png', 'three-3.png', 'three-1img.png', 'three-2img.png', 'three-1title.png', 'three-2title.png', 'threeBg.png', 'two-content.png', 'vector.png', 'war.png', 'yun.png', 'order.jpg'],function(){
                EL.loading.classList.add('loading-hide');
                setTimeout(function(){
                    EL.loading.parentNode.removeChild(EL.loading);
                    touchScroll = new touchScroll('#wrapper',{
                        start:function(){


                        },
                        end:function(scroll){
                            var actives = $("#wrapper").getElementsByClassName("active");
                            if(actives.length>0){
                                for(var i=0,l=actives.length;i<l;i++){
                                    var tmp = actives[i].getAttribute("class");
                                    tmp = tmp.replace("active","");
                                    actives[i].setAttribute("class", tmp);
                                }
                                
                            }

                            var curobj = $("#wrapper").getElementsByClassName("item")[touchScroll.current];
                            var tmp = curobj.getAttribute("class");
                            tmp += " active";
                            curobj.setAttribute("class",tmp);
                        }
                    });

                },200);
            })
            
            this.bindEvent();
            
        },
        bindEvent:function(){
            onTab(EL.musicTip,function(){
                if(!!EL.audio){
                    var audio = EL.audio;
                    if(audio.paused){
                        audio.play();
                    }else{
                        audio.pause();
                        config.closeBGM = true;
                    }
                    EL.musicTip.classList.toggle('music-tip-on');
                }
            });

            onTab(EL.tip,function(){
                var current = touchScroll.current+1,
                    len = touchScroll.len;
                    console.log(current);
                if(current<len){
                    touchScroll.next();
                }
                
            });

            //第一屏touchstart时 播放音乐，兼容部分机器不支持自动播放
            $('#item0').addEventListener('touchstart',function(){
                if(config.closeBGM) return;
                if(!!EL.audio){
                    EL.audio.play();
                }
                return false;
            },false);

            /*最后一屏*/
            var SY=0;
            if(!!EL.lastItem){
                EL.lastItem.addEventListener('touchstart',function(e){
                    var touches = e.touches ? e.touches[0] : e;
                    SY = touches.pageY;
                },false);
                EL.lastItem.addEventListener('touchend',function(e){
                    var touches = e.changedTouches[0],
                        diffY = touches.clientY - SY;
                    if(diffY<-20){
                        EL.shareTip.style.display='block'
                    }
                },false);
            }

            onTab(EL.shareTip,function(){
                 EL.shareTip.style.display='none'
            });
        },
        loadImg:function (arr,cbk){
            var len = arr.length,
                cbk = cbk || function(){};
                var imgFunc;
            (function(){
                var img = new Image();
                    imgFunc= arguments;
                img.onload=function(){
                    if(config.loadImgIndex==len-1){
                        cbk();
                    }else{
                        config.loadImgIndex++;
                        $("#loadingNum").innerHTML = parseInt((config.loadImgIndex/len) * 100, 10) + "%";
                        
                        imgFunc.callee();
                    }
                }
                img.src = config.path+arr[config.loadImgIndex]+'?20150326';
                img.onerror = function(){
                    //alert('图片加载出错')
                    setTimeout(cbk, 5000);
                }
                
            })();
        }
        
    }   
    APP.init();

</script>
</body>
</html>